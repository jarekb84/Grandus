# User Story: Place Home Base Visually in Home Hex

**Epic:** [`epic-01-targeted-expansion-and-resource-setup.md`](./epic-01-targeted-expansion-and-resource-setup.md)
**Epic Goal:** Align home base and initial Stone node within specific hexes in Territory View. Implement hex selection to target the `Expand Combat` action specifically at an adjacent hex. Set up the initial home Stone node to be depletable/limited (e.g., 1 Stone capacity, slow respawn) as per the loop requirements. *(Refines existing Territory view for targeted actions and correct initial state).*

---

## Story Goal

Visually represent the player's Home Base centered within its designated starting hex in the Territory View.

---

## Acceptance Criteria

*   A visual representation of the Home Base is displayed in the Territory View.
*   The visual representation is located within the boundaries of the designated home hex.
*   The visual representation is positioned approximately in the center of the designated home hex.

---

## Notes / Context

*   This story focuses solely on the visual placement based on hex coordinates. The specific coordinates of the home hex will be determined during technical planning.
*   This story was derived from Epic '01-Targeted-Expansion-And-Resource-Setup' as part of the initial breakdown.

---

## Embedded Epic Context for Downstream Processing

<!-- ROO CONTEXT - DO NOT MODIFY MANUALLY -->
<!--
Epic Path: ./epic-01-targeted-expansion-and-resource-setup.md
Epic Title: 01-Targeted-Expansion-And-Resource-Setup
Epic Goal Summary: Align home base and initial Stone node within specific hexes in Territory View. Implement hex selection to target the Expand Combat action specifically at an adjacent hex. Set up the initial home Stone node to be depletable/limited (e.g., 1 Stone capacity, slow respawn) as per the loop requirements. (Refines existing Territory view for targeted actions and correct initial state).
Project Context (if available in Epic):
  Project Title: project-01-establish-core-feedback-loop
  Project Goal: Implement the minimum viable gameplay loop connecting the core views: Gather Stone in Territory View, initiate Expand Combat, earn persistent Coins from Combat success (e.g., clearing Wave 1), spend Coins in a minimal Management View to unlock basic Stone-to-Pebble crafting, use crafted Pebbles to conquer the first Hex (e.g., clear Wave 1), and have the conquered Hex reveal a better/new Stone node.
-->

---

## Technical Plan

### 1. Story Analysis Summary:
*   **Goal:** Visually place a Home Base representation in the center of the starting hex (0,0) in the Territory View (Phaser).
*   **Analysis:** The core logic for placing an entity with `id: 'base1'` at hex (0,0) already exists in `src/features/territory/Territory.scene.ts` (lines 215-221), triggered by `src/features/core/GameContext.tsx` adding initial entities.

### 2. Code Discovery & Analysis Summary (Story Scope):
*   **Phase 1 (Primary Target):** `src/features/territory/Territory.scene.ts` identified as the primary target for hex rendering and entity placement.
*   **Phase 2 (Primary Analysis):** `Territory.scene.ts` uses `hexToPixelCoords` for positioning and has specific logic in `addEntity` to place `base1` at hex (0,0). Key symbols: `addEntity`, `hexToPixelCoords`.
*   **Phase 3 (Reference Search):** `search_files` found `addEntity` called in `src/features/core/GameContext.tsx`.
*   **Phase 4 (Reference Analysis):** `GameContext.tsx` initializes `TerritoryScene` and adds initial entities generated by `generateInitialEntities`, including 'base1'. This triggers the placement logic in the scene. No significant SRP violations found related to this story.
*   **Phase 5 (Synthesis):** Existing code handles the core requirement. The plan focuses on verification.

### 3. Required Refactoring (If Any):
*   None identified for this story.
*   *(Future Consideration): Replace hardcoded `id === 'base1'` check in `Territory.scene.ts` with a property check (e.g., `entity.properties.isHomeBase`).*

### 4. Implementation Steps:
1.  **Verify Initial Entity Definition:**
    *   **File:** `src/features/shared/utils/entityGenerator.ts`
    *   **Action:** Confirm `generateInitialEntities()` creates an entity with `id: 'base1'`, `type: EntityType.BUILDING`, and appropriate properties (shape: CIRCLE, size: 40, color: 0x60a5fa). *(Confirmed via `read_file`)*.
2.  **Verify/Update Visual Representation:**
    *   **File:** `src/features/territory/Territory.scene.ts` (`createSpritesForEntity` method)
    *   **Action:** Review if the current dynamic Circle shape is sufficient. If a dedicated sprite is desired later, update preload logic and sprite creation. For now, the existing shape is acceptable.
3.  **Verify Centering:**
    *   **File:** `src/features/territory/Territory.scene.ts` (`addEntity` method, lines 215-221)
    *   **Action:** Run the game and visually inspect the Territory View. Confirm the blue circle ('base1') appears centered in hex (0,0). Adjust x/y offsets slightly if needed for visual polish based on the circle's origin.

### 5. Architectural & Standards Compliance:
*   Placing visuals in Phaser aligns with Technology Responsibilities (`05-architecture-patterns.md`).
*   File location (`src/features/territory/`) aligns with Directory Structure (`06-directory-structure.md`).
*   No identified violations of core principles within this story's scope.

### 6. Manual Testing Guidance:
*   Load the game.
*   Observe the Territory View.
*   Verify a blue circle representing the home base is visible.
*   Verify the circle is positioned within the central hex (0,0).
*   Verify the circle appears reasonably centered within that hex.

### 7. Dependencies:
*   `src/features/core/GameContext.tsx` (initialization)
*   `src/features/shared/utils/entityGenerator.ts` (entity data)

### 8. (Optional) Complexity Estimate:
*   Low

---

**status:** done