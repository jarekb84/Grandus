# User Story: Visualize Respawn Cycle Progress (04d)

**Epic:** [../epic-01-targeted-expansion-and-resource-setup.md](../epic-01-targeted-expansion-and-resource-setup.md)
**Epic Goal:** Align home base/node, implement hex selection for Expand Combat, make initial node depletable/respawnable.

---

## Story Goal

Enhance the visual feedback for resource nodes by adding a dynamic progress indicator (e.g., filling border, progress bar using Phaser Tweens on an overlay sprite or mask) that visually represents the progression through a single `respawn duration` cycle (0% to 100%), providing users with a sense of time until the next capacity increment. This system will rely on targeted update events/signals from the system refactored in Story 04c.

---

## Initial Acceptance Criteria (Placeholder)

*   The `Territory.scene.ts` listens for specific events/signals indicating the start and end of a node's respawn cycle (e.g., `nodeRespawnCycleStarted(nodeId, duration)`, `nodeRespawnCycleFinished(nodeId)`), generated by the system refactored in Story 04c.
*   Upon receiving a `nodeRespawnCycleStarted` event:
    *   A visual indicator (e.g., overlay sprite, masked graphic) appears on the corresponding node sprite.
    *   A Phaser Tween (`scene.tweens.add`) is initiated to smoothly animate a property of the visual indicator (e.g., overlay `displayWidth` from 0 to full, mask `scaleX` from 0 to 1) over the provided `duration`.
*   Upon receiving a `nodeRespawnCycleFinished` event (or when the tween completes):
    *   The visual indicator is reset or hidden.
*   The animation provides clear visual feedback of the respawn cycle's progress.
*   The implementation uses performant techniques suitable for potentially many nodes (e.g., object pooling for visual indicators if needed, leveraging Phaser Tweens).
*   Consider visual differentiation between a node at capacity 0 and a node actively cycling (>0 capacity but not max).

---

## Notes / Context

*   This story focuses on adding the visual polish for the incremental respawn feature.
*   Critically depends on the targeted update mechanism implemented in Story 04c (Refactor Entity Update Iteration Pattern).
*   Also depends on the incremental respawn logic from Story 04b.
*   Architect Recommendation: Implement this last in the sequence (04a -> 04b -> 04c -> 04d). Use Phaser Tweens triggered by events for smooth, performant animation. Start with an overlay sprite, consider masking if needed.

## User voice Notes (note these were created before the epic architecture overview was done)
### Current Visual Behavior

*   Currently, when a node is depleted after gathering, its visual changes from a full white color to a dark (gray or black) color, representing a depleted state (capacity 0).
*   These changes seem to be static transitions, possibly updating only once per second.

### Desired Visual Behavior: Progress Indicators

*   The current static transition is not sufficient; a sense of *progress* is desired.
*   Instead of discrete, second-by-second changes, the visual should act more like a "loading indicator" or "progress meter" showing the passage of time within a single `respawn duration` cycle (e.g., 5 seconds).
*   Examples of desired visuals include:
    *   A progress bar filling up.
    *   The border around the node filling in.
    *   Some other visual element that represents the cycle time happening from 0% to 100% completion of a single respawn cycle.
*   The purpose is to show the user that the node is in a replenishing cycle and will soon receive its incremental capacity gain (as defined in Story 04a).

### Differentiating Node States Visually

*   There are terminal states that have visuals:
    *   Completely depleted (capacity 0): Currently a dark color (alpha around 0.3), looks gray or black.
    *   Max capacity (full): The node is fully white.
*   A third state that needs a distinct visual is when the node has some capacity (> 0) but is currently undergoing a `respawn duration` cycle to gain more capacity. This is the state that requires the progress visual.
*   The progress visual should indicate that replenishment is underway, but the node is not necessarily fully depleted or fully replenished.

### Technical Considerations (Phaser.js)

*   Acknowledged that entities in the Phaser scene are currently implemented as static sprites, potentially for performance reasons given the possibility of many nodes.
*   A key technical challenge is to determine if there is a performant way within Phaser JS to introduce dynamic progress visuals that update smoothly throughout the cycle duration, rather than just snapping between states.
*   The goal is to avoid updating the game visual state only once per second; a smoother transition is preferred, similar to capabilities found in CSS transitions.
*   The story needs to explore performant methods for adding transitional progress indicators to these sprite-based entities.
---

## Embedded Epic Context for Downstream Processing

<!-- ROO CONTEXT - DO NOT MODIFY MANUALLY -->
<!--
Epic Path: ../epic-01-targeted-expansion-and-resource-setup.md
Epic Title: 01-Targeted-Expansion-And-Resource-Setup
Epic Goal Summary: Align home base/node, implement hex selection for Expand Combat, make initial node depletable/respawnable.
Project Context (if available in Epic):
  Project Title: project-01-establish-core-feedback-loop
  Project Goal: Implement core loop: Gather -> Expand Combat -> Coins -> Crafting -> Conquest -> Better Node.
-->