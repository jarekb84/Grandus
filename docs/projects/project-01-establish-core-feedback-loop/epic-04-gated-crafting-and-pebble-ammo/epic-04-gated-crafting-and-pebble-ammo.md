# Epic: 04-Gated-Crafting-And-Pebble-Ammo

## Epic Goal

*   Add the actual Stone -> Pebbles crafting mechanism (likely in Management View). Ensure it's only usable after the "Learn Rock Breaking" research (Epic 3) is complete. Update the Combat scene to prioritize consuming crafted Pebbles as ammo, using raw Stone only as a fallback. Connects the unlock to tangible resource conversion and usage.

## Status

*   Proposed

## Linked Project

*   **Project File:** [`project-01-establish-core-feedback-loop.md`](../project-01-establish-core-feedback-loop.md)
*   **Overall Project Goal:** Implement the minimum viable gameplay loop connecting the core views: Gather Stone in Territory View, initiate Expand Combat, earn persistent Coins from Combat success (e.g., clearing Wave 1), spend Coins in a minimal Management View to unlock basic Stone-to-Pebble crafting, use crafted Pebbles to conquer the first Hex (e.g., clear Wave 10), and have the conquered Hex reveal a better/new Stone node.

## Scope & Key Features (for this Epic)

*   Modify the existing Crafting section in the Management View (React).
*   Gate the "Craft 10 Pebbles (Cost: 1 Stone)" button/action: Enable it only if the "Learn Rock Breaking" research flag (from Epic 3) is set in the core game state *and* the player has sufficient Stone.
*   Implement the crafting logic: When clicked, consume 1 Stone and add 10 Pebbles to the player's inventory (core game state).
*   Update inventory display in Management and Territory views to show the Pebble count.
*   Modify the player firing logic in the Combat Scene (PhaserJS):
    *   Check if Pebbles are available in inventory (> 0).
    *   If yes, consume 1 Pebble per shot and fire a Pebble projectile (adjust damage if necessary, e.g., 1 damage per Pebble).
    *   If no Pebbles available, fall back to checking for Stone.
    *   If Stone available (> 0), consume 1 Stone per shot and fire a Stone projectile (e.g., 10 damage per Stone).
    *   If neither is available, firing is disabled.

## Out of Scope (for this Epic)

*   Implementing the Wave 10 conquest trigger.
*   Revealing conquered hex nodes.
*   Other crafting recipes or research.
*   Complex ammo switching UI (logic change is sufficient).

## Embedded Project Context

*   **Relevant Project Sections:**
    *   From Project Goal: ...unlock basic Stone-to-Pebble crafting, use crafted Pebbles to conquer the first Hex...
    *   From Key Systems: ...basic Stone -> Pebbles crafting recipe unlocked via the research. Combat Scene (PhaserJS): ...basic player entity firing Pebbles...
    *   From Source Context (Management View): Resource Conversion: Craft gathered resources into essential combat items (ammo...)...
    *   From Source Context (MVP Refined): Basic Crafting (Management View): Implement simple Stone -> Pebbles crafting recipe. Update Territory/Combat to use Pebbles as primary ammo if available.
    *   From User Context: Gather Stone -> Craft Pebbles... I can click, you know, craft 10 pebbles, cost one stone... Update Territory/Combat to use Pebbles as primary ammo if available... I can take the one stone and get it to the point where I can create, you know, 10 pebbles.

## Notes / Design Links / Dependencies (Optional)

*   Depends on Epic 3 for the research unlock flag in the core game state.
*   Requires existing crafting UI element in Management View.
*   Requires access to read/write Stone and Pebble inventory in the core game state.
*   Requires existing player firing logic in Combat Scene to modify.

---
*Generated by Roo `project-epic-generator` mode.*